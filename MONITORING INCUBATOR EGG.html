<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IoT Monitoring System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; }
        .cards { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; flex-wrap: wrap; }
        .card { background: #fff; padding: 20px; border-radius: 10px; width: 180px; text-align: center; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .card h2 { margin: 10px 0; font-size: 2em; }
        .chart-container { width: 80%; max-width: 800px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    </style>
</head>
<body>
    <h1>IoT Monitoring System</h1>

    <!-- Latest Values Cards -->
    <div class="cards">
        <div class="card">
            <h4>Temperature</h4>
            <h2 id="latestTemp">-- °C</h2>
        </div>
        <div class="card">
            <h4>Humidity</h4>
            <h2 id="latestHum">-- %</h2>
        </div>
    </div>

    <!-- Charts -->
    <div class="chart-container">
        <canvas id="temperatureChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="humidityChart"></canvas>
    </div>

    <script>
        // Your Google Sheet CSV link
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRygk6rsDcpdeupU698H9MvQxT9sN9G4QkQJ6UwfSRXUSY4M5vfcDGrQzbpiE0ZGL_zXPEToCoMyNut/pub?output=csv";

        let temperatureChart, humidityChart;

        async function fetchSheetData() {
            const response = await fetch(sheetURL);
            const data = await response.text();
            const rows = data.split("\n").slice(1); // skip header

            const time = [], temperature = [], humidity = [];

            rows.forEach(row => {
                const cols = row.split(",");
                if(cols.length >= 3 && cols[1] && cols[2]) {
                    time.push(cols[0]);
                    temperature.push(parseFloat(cols[1]));
                    humidity.push(parseFloat(cols[2]));
                }
            });

            return { time, temperature, humidity };
        }

        async function updateDashboard() {
            const data = await fetchSheetData();

            // Update latest values
            if(data.temperature.length > 0) document.getElementById('latestTemp').textContent = data.temperature[data.temperature.length-1] + " °C";
            if(data.humidity.length > 0) document.getElementById('latestHum').textContent = data.humidity[data.humidity.length-1] + " %";

            // Destroy previous charts if exist
            if(temperatureChart) temperatureChart.destroy();
            if(humidityChart) humidityChart.destroy();

            // Temperature chart
            const ctxTemp = document.getElementById('temperatureChart').getContext('2d');
            temperatureChart = new Chart(ctxTemp, {
                type: 'line',
                data: {
                    labels: data.time,
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: data.temperature,
                        borderColor: 'rgba(255,99,132,1)',
                        backgroundColor: 'rgba(255,99,132,0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: { responsive: true }
            });

            // Humidity chart
            const ctxHum = document.getElementById('humidityChart').getContext('2d');
            humidityChart = new Chart(ctxHum, {
                type: 'line',
                data: {
                    labels: data.time,
                    datasets: [{
                        label: 'Humidity (%)',
                        data: data.humidity,
                        borderColor: 'rgba(54,162,235,1)',
                        backgroundColor: 'rgba(54,162,235,0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: { responsive: true }
            });
        }

        // Initial load
        updateDashboard();

        // Auto-refresh every 15 seconds
        setInterval(updateDashboard, 15000);
    </script>
</body>
</html>
